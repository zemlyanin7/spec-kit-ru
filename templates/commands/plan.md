---
description: Выполнить процесс планирования реализации, используя шаблон плана для генерации проектных артефактов.
scripts:
  sh: scripts/bash/setup-plan.sh --json
  ps: scripts/powershell/setup-plan.ps1 -Json
agent_scripts:
  sh: scripts/bash/update-agent-context.sh __AGENT__
  ps: scripts/powershell/update-agent-context.ps1 -AgentType __AGENT__
---

## Ввод пользователя

```text
$ARGUMENTS
```

Вы **ОБЯЗАНЫ** учитывать ввод пользователя, если он не пустой.

## Общий план

1. **Подготовка**: Запустите `{SCRIPT}` в корне репозитория и извлеките из JSON значения FEATURE_SPEC, IMPL_PLAN, SPECS_DIR, BRANCH. Для аргументов с одинарной кавычкой (например, "I'm Groot") используйте экранирование: `'I'\''m Groot'` или двойные кавычки `"I'm Groot"`.

2. **Контекст**: Прочитайте FEATURE_SPEC и `/memory/constitution.md`. Шаблон IMPL_PLAN уже скопирован — загрузите его для заполнения.

3. **Выполните процесс планирования** согласно структуре IMPL_PLAN:
   - Заполните раздел «Технический контекст», помечая неизвестные значения как "NEEDS CLARIFICATION".
   - Заполните раздел «Проверка конституции» использованием правил из конституции.
   - Оцените гейты (ERROR, если нарушения не обоснованы).
   - Фаза 0: сформируйте `research.md`, разрешите все NEEDS CLARIFICATION.
   - Фаза 1: сформируйте `data-model.md`, каталог `contracts/`, `quickstart.md`.
   - Фаза 1: обновите контекст агента, запустив соответствующий скрипт.
   - Повторно оцените гейты конституции после проектирования.

4. **Остановитесь и сообщите результат**: Команда завершается после планирования на Фазе 2. Сообщите ветку, путь к IMPL_PLAN и список созданных артефактов.

## Фазы

### Фаза 0: Структура и исследование

1. **Выявите неизвестные** из раздела «Технический контекст»:
   - Для каждого NEEDS CLARIFICATION → задание на исследование
   - Для каждой зависимости → задача на best practices
   - Для каждой интеграции → задача на исследование паттернов

2. **Сформируйте задания исследователям**:
   ```
   Для каждого неизвестного в Technical Context:
     Task: "Research {unknown} for {feature context}"
   Для каждой технологической опции:
     Task: "Find best practices for {tech} in {domain}"
   ```

3. **Соберите выводы** в `research.md` с форматом:
   - Decision: [что выбрано]
   - Rationale: [почему выбрано]
   - Alternatives considered: [какие варианты рассматривались]

**Результат**: research.md без нерешённых NEEDS CLARIFICATION.

### Фаза 1: Проектирование и контракты

**Предпосылки:** `research.md` завершён.

1. **Извлеките сущности** из спецификации → `data-model.md`:
   - Название сущности, поля, связи.
   - Правила валидации из требований.
   - Состояния/переходы, если применимо.

2. **Сгенерируйте контракты API** на основе функциональных требований:
   - Каждое пользовательское действие → endpoint.
   - Используйте стандартные паттерны REST/GraphQL.
   - Запишите OpenAPI/GraphQL схему в каталог `/contracts/`.

3. **Обновите контекст агента**:
   - Запустите `{AGENT_SCRIPT}`.
   - Скрипт автоматически определит активного ИИ-агента.
   - Обновите соответствующий файл контекста агента.
   - Добавляйте только технологии, появившиеся в текущем плане.
   - Сохраните пользовательские дополнения между маркерами.

**Результат**: data-model.md, файлы в `/contracts/`, quickstart.md, обновлённый контекст агента.

## Ключевые правила

- Работайте с абсолютными путями.
- Завершайте выполнение с ошибкой, если гейты конституции не пройдены или остаются нерешённые уточнения.
