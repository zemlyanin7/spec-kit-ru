---
description: Сформировать tasks.md с задачами в порядке зависимостей на основе доступных проектных артефактов.
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## Ввод пользователя

```text
$ARGUMENTS
```

Вы **ОБЯЗАНЫ** учитывать ввод пользователя перед продолжением (если он не пустой).

## Общий план

1. **Подготовка**: Запустите `{SCRIPT}` из корня репозитория и извлеките FEATURE_DIR и список AVAILABLE_DOCS. Все пути должны быть абсолютными. Для строк с одинарной кавычкой используйте экранирование `'I'\''m Groot'` или двойные кавычки.

2. **Загрузите проектные документы** из FEATURE_DIR:
   - **Обязательно**: plan.md (технологии, библиотеки, структура), spec.md (пользовательские истории с приоритетами)
   - **Опционально**: data-model.md (сущности), каталог contracts/ (API), research.md (принятые решения), quickstart.md (тестовые сценарии)
   - Не все проекты содержат полный набор документов — формируйте задачи по доступным данным.

3. **Выполните генерацию задач**:
   - Извлеките из plan.md стек технологий, библиотеки, структуру проекта.
   - Извлеките из spec.md пользовательские истории и их приоритеты (P1, P2, P3...).
   - Если есть data-model.md: сопоставьте сущности с пользовательскими историями.
   - Если есть contracts/: сопоставьте эндпоинты с историями.
   - Если есть research.md: используйте решения для задач на настройку.
   - Сформируйте задачи, сгруппированные по пользовательским историям (см. правила ниже).
   - Постройте схему зависимостей, показывающую порядок завершения историй.
   - Для каждой истории добавьте примеры параллельной работы.
   - Проверьте полноту — каждая история должна иметь полный набор задач и оставаться независимой.

4. **Сформируйте tasks.md** на базе `.specify/templates/tasks-template.md`, заменив:
   - Название фичи из plan.md.
   - Фаза 1: задачи по настройке проекта.
   - Фаза 2: базовые задачи, блокирующие все истории.
   - Фазы 3+: по одной фазе на каждую историю (в порядке приоритетов).
   - Внутри каждой фазы: цель истории, критерии независимого тестирования, тесты (если нужны), задачи реализации.
   - Финальная фаза: полировка и сквозные улучшения.
   - Все задачи должны соответствовать строгому формату чек-листа (см. ниже).
   - Указывать точные пути к файлам.
   - Добавить раздел зависимостей между фазами и примеры параллельной работы.
   - Добавить раздел стратегии реализации (MVP, итеративная доставка).

5. **Отчёт**: Выведите путь к созданному tasks.md и краткое резюме:
   - Общее количество задач.
   - Количество задач на каждую историю.
   - Выявленные параллельные возможности.
   - Критерии независимого тестирования для каждой истории.
  - Рекомендованный MVP (обычно User Story 1).
  - Подтверждение, что все задачи соответствуют формату чек-листа.

Контекст для генерации задач: {ARGS}

Tasks.md должен быть сразу применим — каждая задача должна быть достаточно конкретной, чтобы ИИ мог выполнить её без дополнительных уточнений.

## Правила генерации задач

**КРИТИЧНО**: Задачи организуются по пользовательским историям, чтобы обеспечить независимую реализацию и тестирование.

**Тесты — ОПЦИОНАЛЬНО**: Добавляйте тестовые задачи только если этого требует спецификация или пользователь просит TDD.

### Формат чек-листа (ОБЯЗАТЕЛЕН)

Каждая задача строго в формате:

```
- [ ] [TaskID] [P?] [Story?] Описание с путём к файлу
```

**Компоненты формата**:

1. `- [ ]` — обязательный чекбокс.
2. **TaskID** — последовательный идентификатор (T001, T002...).
3. **[P]** — ставьте только если задачу можно выполнять параллельно (разные файлы, нет зависимостей).
4. **[Story]** — обязательно для задач внутри фаз историй (`[US1]`, `[US2]` и т.д.).  
   - Фазы Setup и Foundational: без метки истории.  
   - Фазы историй: метка обязательна.  
   - Фаза Polish: без метки.
5. **Описание** — чёткое действие + полный путь к файлу.

### Организация задач

1. **По пользовательским историям (spec.md)** — основной принцип:
   - Каждая история (P1 → Pn) получает отдельную фазу.
   - Свяжите с историей модели, сервисы, UI/endpoint, тесты (если нужны).
   - Отмечайте зависимости между историями (желательно, чтобы их не было).

2. **По контрактам**:
   - Каждый endpoint → история, которую он обслуживает.
   - Если требуются тесты: перед реализацией истории добавьте контрактные тесты с пометкой [P].

3. **По модели данных**:
   - Каждая сущность → соответствующая история.
   - Если сущность нужна нескольким историям — перенесите в Setup либо первую историю, где она требуется.
   - Связи между сущностями → задачи уровня сервисов в нужной истории.

4. **Инфраструктура**:
   - Общая инфраструктура → Setup.
   - Блокирующие зависимости (БД, авторизация) → Foundational.
   - Специфичные настройки под историю → внутри соответствующей фазы.

### Структура фаз

- **Фаза 1**: Setup (инициализация проекта).
- **Фаза 2**: Foundational (блокирующие предпосылки).
- **Фазы 3+**: Пользовательские истории по приоритетам. Внутри каждой:  
  тесты (если нужны) → модели → сервисы → endpoints/UI → интеграция.
  Фaza должна образовывать независимый инкремент.
- **Финальная фаза**: Полировка и сквозные доработки.
